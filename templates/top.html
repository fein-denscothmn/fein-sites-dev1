<!DOCTYPE html>
<html lang="ja">

<head>
 <meta charset="UTF-8">
 <title>fein's Flask</title>
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <meta name="description" content="フロントエンド3言語によるWebサイトに慣れてきたら、何かしらのフレームワークを導入して開発するのも楽しいですよ。ここではPythonのFlaskをご紹介します。">
 <meta name="keywords" content="Python, Flask, 個人サイト制作">
 <meta name="robots" content="index, follow">
 <meta property="og:title" content="個人サイトへPythonのFlaskを導入する">
 <meta property="og:description"
  content="フロントエンド3言語によるWebサイトに慣れてきたら、何かしらのフレームワークを導入して開発するのも楽しいですよ。ここではPythonのFlaskをご紹介します。">
 <meta property="og:image" content="{{ url_for('static', filename='images/anafish.png') }}">
 <meta property="og:url" content="https://fein-sites-dev1.ew.r.appspot.com/top">
 <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">


 <!-- 構造化データ -->
 <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "個人サイトへPythonのFlaskを導入する",
      "url": "https://fein-sites-dev1.ew.r.appspot.com/top",
      "logo": "https://fein-sites-dev1.ew.r.appspot.com/static/images/barracuda.jpg"
    }
    </script>

 <!-- CSSファイル -->
 <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/pstyle.css') }}">
 <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
 <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/header.css') }}">
 <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/footer.css') }}">
 <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/flower.css') }}">
 <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/menu.css') }}">
 <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/collapsible.css') }}">
 <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/feinpan.css') }}">
 <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/feinheadline1.css') }}">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-tomorrow.min.css">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
 <link rel="preconnect" href="https://fonts.googleapis.com">
 <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
 <link
  href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap"
  rel="stylesheet">
 <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='icons/appleicon.png') }}">
 <link rel="icon" sizes="32x32" href="{{ url_for('static', filename='icons/favicon.ico') }}" type="image/x-icon">

 <!-- Googleタグマネージャー -->
 <script async src="https://www.googletagmanager.com/gtag/js?id=G-827JM6N5CS"></script>
 <script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-827JM6N5CS');
 </script>

 <!-- Microsoftタグ -->
 <script>
  (function (c, l, a, r, i, t, y) {
   c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
   t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
   y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
  })(window, document, "clarity", "script", "obazqypsh8");
 </script>

 <!-- JavaScriptファイル -->
 <script src="{{ url_for('static', filename='js/underline.js') }}"></script>
 <script src="{{ url_for('static', filename='js/feinfade.js') }}"></script>
 <script src="{{ url_for('static', filename='js/feinScroll.js') }}"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js"></script>
 <script src="{{ url_for('static', filename='js/album.js') }}"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.7.1/gsap.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-python.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-bash.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-json.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-yaml.min.js"></script>
 <script src="{{ url_for('static', filename='js/collapsible.js') }}"></script>

 <!-- Service Workerの登録 -->
 <script>
  if ('serviceWorker' in navigator) {
   navigator.serviceWorker.register('/service-worker.js')
    .then(registration => {
     console.log('ServiceWorker registration successful with scope: ', registration.scope);
    })
    .catch(error => {
     console.log('ServiceWorker registration failed: ', error);
    });
  }
 </script>
</head>

<body>

 <nav class="den_nav">
  <ul>
   <li><a href="https://fein-sites-dev1.ew.r.appspot.com/"><img src="/menu/mspass.png" alt="このサイトのシンボルマーク"
      class="feinhome"></a></li>
   <li><a href="/" class="animated-link">ホーム</a></li>
   <li><a href="/another-eden/anaden_sitemap.html" class="animated-link">アナザーエデン</a></li>
   <li><a href="/fish/fish_sitemap.html" class="animated-link">アウトドアのエリア</a></li>
   <li><a href="/contents/site_create.html" class="animated-link">個人サイト制作</a></li>
   <li><a href="/contents/protect.html" class="animated-link">AI学習を防ぐ工夫</a></li>
   <li><a href="/contents/rss.html" class="animated-link">更新のお知らせ</a></li>
  </ul>
 </nav>

 <!--レスポンシブデザイン-->
 <div class="feincontainer">


  <!--パンくずリスト-->
  <div>
   <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/">Home（グラスタの場所一覧表〜入手範囲別〜）</a></li>
    <li class="breadcrumb-item"><a href="site_create.html">個人サイト制作：サイトマップ</a></li>
    <li class="breadcrumb-item active" aria-current="page">個人サイトへPythonのFlaskを導入する</li>
   </ol>
  </div>

  <div class="search-container">
   <script async src="https://cse.google.com/cse.js?cx=07df877a5cdad4ece">
   </script>
   <div class="gcse-searchbox-only"></div>
  </div>

  <!-- ハンバーガーメニュー -->
  <div class="fden-hamburger-menu">
   <button class="fden-hamburger-button" id="fden-hamburger-button" onclick="toggleMenu()">☰ メニューを開く
    ▼</button>
   <div class="fden-menu" id="fden-menu">
    <!-- メニュー内容は外部ファイルから読み込む -->
    <div id="fden-menu-content"></div>
   </div>
  </div>
  <script src="{{ url_for('static', filename='js/menu.js') }}"></script>
  <!-- ハンバーガーメニューここまで -->

  <!--サイトタイトル-->
  <div class="header-frame">
   <div class="header-container">
    <img src="{{ url_for('static', filename='images/VisualAtelierCode.png') }}" alt="fein's personal site"
     class="header-image">
    <div class="header-text">
     <a href="https://fein-sites-dev1.ew.r.appspot.com/">fein's personal site</a>
    </div>
   </div>
  </div>

  <div class="spacer"></div>

  <button id="generate-headings" data-open-text="個人サイトへPythonのFlaskを導入するの目次を開く ▼"
   data-close-text="個人サイトへPythonのFlaskを導入するの目次を閉じる ▲">個人サイトへPythonのFlaskを導入するの目次を開く ▼</button><!--目次の自動生成-->
  <div class="spacer"></div>

  <p><a href="{{ url_for('static', filename='contents/site_create.html') }}">個人サイト制作：サイトマップへ戻る</a></p>

  <!-- ●ヘッダーここまで。直下でコンテンツ開始● -->
  <h1 class="background-waveimage-heading"><span>個人サイトへPythonのFlaskを導入する</span></h1>
  <p>
   Flaskは、Pythonというプログラミング言語を使って、ウェブサイトやウェブアプリケーションを作成するためのツールです。<br>
   これを「ウェブフレームワーク」と呼びます。<br>
   ウェブフレームワークは、ウェブアプリケーションを簡単に作るための土台や便利な機能を提供してくれるものです。<br>
   Flaskはとても軽量でシンプルなフレームワークなのですよ。
  </p>

  <p>ちなみに、このボタンは動作検証に使ったシンプルFlaskアプリです。</p>
  <button class="animated-button" onclick="showMessage()">クリックしてね！</button>
  <script src="{{ url_for('static', filename='js/pscript.js') }}"></script>

  <h2>Flaskのディレクトリ構造</h2>
  <p>私のサイトは少しだけ変わった感じでFlaskを取り入れているので、基本的な導入方法を見ながらソースコードを書いていきます。</p>
  <p>まずはFlaskプロジェクトの一般的なディレクトリ構造を示していきましょう。<br>
   この構造はコードを整理しやすくし、プロジェクトを拡張しやすくするためによく使われます。</p>

  <p class="gra">Flaskの一般的なディレクトリ構造</p>
  <div class="code-container">
   <pre><code class="language-txt">
my_flask_app/
│
├── app/
│ ├── __init__.py
│ ├── routes.py
│ ├── models.py
│ ├── static/
│ │ ├── css/
│ │ ├── js/
│ │ └── images/
│ └── templates/
│ ├── layout.html
│ └── index.html
│
├── venv/
│ └── (仮想環境関連のファイル)
│
├── .gitignore
├── config.py
├── requirements.txt
└── run.py

</code></pre>
  </div>
  <p>それぞれのディレクトリやファイルが何を示しているか、説明していきますね。<br>
   ちなみに「ディレクトリ」というのは「フォルダ」と解釈して頂いて構いません。</p>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="{{ url_for('static', filename='flower1/flower1(114).jpg') }}" alt="フェードアウト効果の草花写真">
   </div>

   <dl>
    <dt>my_flask_app/</dt>
    <dd>プロジェクトのルートディレクトリです。</dd>
    <dt>app/</dt>
    <dd>Flaskアプリケーションのメインディレクトリです。</dd>
    <dt>__init__.py</dt>
    <dd>Flaskアプリケーションを初期化するためのファイルです。<br>
     Flaskインスタンスを作成し、ルートや設定をここで定義します。</dd>
    <dt>routes.py</dt>
    <dd>アプリケーションのルート（URL）を定義するファイルです。<br>
     ルーティングのロジックがここに含まれます。</dd>
    <dt>models.py</dt>
    <dd>データベースのモデルを定義するファイルです。<br>
     データベースとやり取りするクラスをここに記述します。</dd>
    <dt>static/</dt>
    <dd>静的ファイル（CSS、JavaScript、画像など）を格納するディレクトリです。</dd>
    <dt>css/</dt>
    <dd>スタイルシートを格納するサブディレクトリです。</dd>
    <dt>js/</dt>
    <dd>JavaScriptファイルを格納するサブディレクトリです。</dd>
    <dt>images/</dt>
    <dd>画像ファイルを格納するサブディレクトリです。</dd>
    <dt>templates/</dt>
    <dd>HTMLテンプレートを格納するディレクトリです。</dd>
    <dt>layout.html</dt>
    <dd>他のテンプレートが継承するベーステンプレートです。</dd>
    <dt>index.html</dt>
    <dd>ホームページのテンプレートです。</dd>
    <dt>venv/</dt>
    <dd>仮想環境を格納するディレクトリです。<br>
     仮想環境は、プロジェクトごとにPythonパッケージを管理するためのものです。</dd>
    <dt>.gitignore</dt>
    <dd>Gitに無視させるファイルやディレクトリを記述するファイルです。<br>
     仮想環境や一時ファイルなどをここにリストアップします。</dd>
    <dt>config.py</dt>
    <dd>アプリケーションの設定を行うファイルです。<br>
     データベースの接続情報やセキュリティキーなどをここに記述します。</dd>
    <dt>requirements.txt</dt>
    <dd>プロジェクトで使用するPythonパッケージをリストアップするファイルです。<br>
     これにより、他の開発者が同じ環境を再現できます。</dd>
    <dt>run.py</dt>
    <dd>アプリケーションを実行するためのスクリプトです。<br>
     このスクリプトを実行することでFlaskサーバーが起動します。</dd>
   </dl>

  </div>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="{{ url_for('static', filename='flower1/flower1(115).jpg') }}" alt="フェードアウト効果の草花写真">
   </div>

   <p>このようなディレクトリ構造を使うことで、Flaskプロジェクトを効率的に管理し、拡張することができます。<br>
    この中には私がまだ実装していないものも多数含まれていますが、現段階では動かせるというだけで、後日足していけば良いのですよ。<br>
    初めから完璧に完璧に…なんてやってたら大変だからね。<br>
    では、次に私のサイトのFlaskフレームワークのディレクトリ構造を見ていきます。</p>

  </div>

  <p class="codegra" id="feinsappFlask">fein's app のFlaskフレームワーク</p>

  <div class="code-container">
   <pre><code class="language-txt">
FEIN-SITES-DEV1/
│  app.yaml          # App Engine の設定ファイル。デプロイと実行環境の設定を定義
│  main.py           # Flask アプリケーションのメインファイル。ルートやサーバーの設定が含まれる
│  README.md         # プロジェクトの概要や使い方を記述する説明ファイル
│  requirements.txt  # アプリケーションが依存する Python パッケージをリストアップするファイル
│
├─static/            # 静的ファイル（CSS, JavaScript, 画像など）を配置するディレクトリ
│   ├─ images/       # 画像ファイルを保存するサブディレクトリ
│   │     example.jpg  # サンプル画像ファイル
│   ├─ css/          # CSS ファイルを保存するサブディレクトリ
│   │     pstyle.css   # プロジェクトのスタイルシート
│   ├─ js/           # JavaScript ファイルを保存するサブディレクトリ
│   │     pscript.js   # プロジェクトのスクリプト
│   └─その他のディレクトリや静的ファイル  # 普通のWebサイトの構造となっている
│
├─templates/         # Flask のテンプレートファイル（HTML ファイル）を配置するディレクトリ
│      top.html      # Flask アプリの動的コンテンツ用 HTML テンプレート
│
│   【上側がFlaskフレームワーク。サーバーサイドスクリプトを活用した動的Webサイトです。】
│   【下側が普通のホームぺージ。フロントエンド3言語による静的Webサイトです。】
│
└─www/               # 静的ウェブサイトのルートディレクトリ。静的な HTML ファイルを配置
    │  index.html      # 静的ウェブサイトのホームページ
    │  .hintrc         # HTMLHint の設定ファイル（コード品質チェック用）
    │  favicon.ico     # ブラウザのタブに表示されるアイコン
    │  manifest.json   # PWA の設定ファイル。アプリのメタデータを定義
    │  robots.txt      # 検索エンジンに対するクローリング設定ファイル
    │  service-worker.js # PWA のサービスワーカー。オフライン対応やキャッシュ管理を実現
    └─その他のディレクトリや静的ファイル  # 普通のWebサイトの構造となっている

</code></pre>
  </div>

  <p>私が作っているFlaskフレームワークの構造は、プロジェクトの拡張性とメンテナンス性を優先した設計にしています。<br>
   プロジェクトが複雑化しても、できる限り管理しやすいように配慮してるんだよね。</p>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="{{ url_for('static', filename='flower1/forest1(133).jpg') }}" alt="フェードアウト効果の草花写真">
   </div>

   <p>Progressive Web App (PWA) の機能が必要なのは、言うまでもなくユーザーエクスペリエンスを向上させるためです。<br>
    venv ディレクトリ（仮想環境）はまだ作ってないですね。<br>
    小規模プロジェクトで依存関係が少なく、他のプロジェクトと競合しない場合、仮想環境を使わなくても問題は起きないです。<br>
    いずれいろいろ整えますが、その折にはまた解説ページ作りますよ。</p>

  </div>

  <p>ここで、ちょっと…このサイト全体の意図みたいなものを説明しておこうかな…</p>

  <h4>2つの性質が異なるサイトを切り離せる</h4>
  <p>これは私独特の意図ですよ。<br>
   上述したけど、一般的なFlaskフレームワーク構造と、私のサイトのFlaskフレームワーク構造は、ちょーっとだけ異なります。<br>
   app.yaml と main.py で全体をコントロールしているのですが、次のように2つのサイトに分かれているんです。</p>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="{{ url_for('static', filename='flower1/flower1(117).jpg') }}" alt="フェードアウト効果の草花写真">
   </div>

   <ol>
    <li>index.html はフロントエンド3言語による普通のWebサイト</li>
    <li>top.html はFlaskフレームワークによるサーバーサイドスクリプトを活用したWebサイト</li>
   </ol>
   <p>特定のページのURLを目指さない限り、私のWebサイトへアクセスすると、まずは 1 の index.html が表示されるよう、設定しています。<br>
    2 の top.html が、まるで従属しているような実装のされ方となっています。</p>

   <p>これら2つのサイトはそれぞれ templates と www、2つのディレクトリの配下にあります。<br>
    CSS と JavaScript は共有していませんが、現状は2つのサイトで同じものを使っています。<br>
    Flaskフレームワークを使った普通のWebサイトは、templates ディレクトリに html を格納しておくものなんですよね。─ もちろん例外などいくらでもありますが ─</p>

  </div>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="{{ url_for('static', filename='flower1/flower1(118).jpg') }}" alt="フェードアウト効果の草花写真">
   </div>

   <p>Flaskに限らず、フレームワークというものには流行り廃りがあります。<br>
    まず大丈夫だろうけど、Flaskもこれから何十年も使われ続けるとは限らない。<br>
    非常に有名なフレームワークなので、終息するにしても、利用者のことを考えてくれるでしょう。<br>
    でも未来のことは誰にも分かりません。</p>

   <p>そこで、「フロントエンド3言語による普通のWebサイト」と「Flaskフレームワークによるサーバーサイドスクリプトを活用したWebサイト」を簡単に切り離せる仕組みにしたんです。<br>
    次の画像なら少しは分かりやすいかも…</p>

  </div>

  <div class="content">
   <img src="{{ url_for('static', filename='images/Flaskによる構造.jpg') }}" alt="Flaskによる構造" class="biggraphic fade-in-out">
  </div>

  <p>FEIN-SITES-DEV1/ が、App Engine のプロジェクトルートディレクトリに当たります。<br>
   その配下にFlaskフレームワークがあり、加えて www という静的ウェブサイトのルートディレクトリがある。<br>
   何か不測の事態が発生した時には、www ディレクトリだけを切り取り、別の場所へ簡単にデプロイできるのですよ。<br>
   HTML・CSS・JavaScript だけで作った普通のホームページであれば、たいていどこのクラウドでも、容易に動かすことができるからです。<br>
   Flaskフレームワークのコンテンツにしても、多少の停止はあるでしょうが、移転やリプレイスに耐えられるようにしたいな。</p>

  <p>イーロン・マスクがTwitterをおもちゃにしたせいで、多くの人がSNSの移転を検討するようになりました。<br>
   そういうのを見ていて、自分が持つコンテンツをいつでも移すことができるというのは、大きな強みになると考えているのです。</p>

  <h3>静的Webサイトと動的Webサイト</h3>
  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="{{ url_for('static', filename='flower1/flower1(119).jpg') }}" alt="フェードアウト効果の草花写真">
   </div>

   <p>静的Webサイトは、主にHTML、CSS、JavaScriptなどの静的ファイルから構成され、サーバーからクライアントにそのまま配信されます。<br>
    静的コンテンツはサーバー側で変更されず、クライアント側で表示される際には常に同じ内容になります。<br>
    一般的に個人サイトとかホームページなどと呼ばれているのは、このタイプのWebサイトです。<br>
    極端な話をすればHTMLだけでも構築できることから、初心者向けの簡単サイトのように言われがちですが、それは誤解と言えます。<br>
    シングルページアプリケーション（SPA）というものがあって、まるで動的サイトのような動きを実現することができますよ？</p>

   <p>一方、動的Webサイトは、サーバーサイドスクリプトを活用してコンテンツを生成します。<br>
    ユーザーの入力やデータベースの情報に応じて、動的にコンテンツが生成されます。<br>
    このプロセスにはサーバー側のプログラミング言語やフレームワークが必要で、Flaskはその一例です。<br>
    ここで、フレームワークとCGIの違いについて説明しておきましょう。</p>
  </div>

  <h4>フレームワークとCGIの違い</h4>
  <p><strong>CGI（Common Gateway
    Interface）</strong>はウェブサーバーとプログラム（通常はシェルスクリプトやプログラミング言語で書かれたスクリプト）との間のインターフェースです。<br>
   1990年代初頭に開発されたもので、ウェブページが動的に生成されるための最初の手段の一つです。<br>
   CGIプログラムは、クライアント（ユーザー）がリクエストを送ると、ウェブサーバーがそのリクエストをCGIプログラムに渡し、プログラムが処理を行い、その結果をサーバーに返して表示されます。<br>
   一般的にCGIスクリプトはサーバー上で毎回新しくプロセスが生成されるため、パフォーマンスの面で効率が悪いことがあります。<br>
   でも決めつけも良くないでしょうね。<br>
   私はCGIを古典的手法と教わったけど、何か良い感じのCGIの実装方法があるのかもしれません。</p>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="{{ url_for('static', filename='flower1/flower1(120).jpg') }}" alt="フェードアウト効果の草花写真">
   </div>

   <p>一方、<strong>フレームワーク</strong>は特定の用途や機能に特化した一連のツールやライブラリ、規約を提供するソフトウェアです。<br>
    フレームワークを使用することで、開発者は共通のタスクを効率的に行うことができ、コーディングの時間や労力を削減できます。<br>
    例えば、ウェブ開発用のフレームワークには、Flask(Python)、Django(Python)、Ruby on Rails(Ruby)、Express(Node.js) などがあります。<br>
    これらのフレームワークは、ルーティング、セッション管理、テンプレートエンジン、データベース接続など、ウェブアプリケーションを開発する際に頻繁に使われる機能を提供します。</p>

  </div>

  <h2>依存関係を管理するrequirements.txt</h2>
  <p>requirements.txtとは、Pythonのプロジェクトで使用するパッケージ（ライブラリ）をリストアップしたテキストファイルです。<br>
   このファイルは、プロジェクトの依存関係を管理し、他の開発者やデプロイ環境で同じパッケージを簡単にインストールできるようにするために使われます。</p>
  <p class="codegra" id="flaskrequirements_txt">依存関係を管理するrequirements.txt</p>
  <div class="code-container">
   <pre><code class="language-txt">
Flask==2.3.2
gunicorn==20.1.0

</code></pre>
  </div>

  <p>requirements.txtファイルには各パッケージの名前とバージョンが記載されているから、プロジェクトに必要な特定のバージョンのパッケージを確実にインストールすることができますよ。<br>
   このファイルを使って依存関係をインストールするには、コマンドラインで以下のコマンドを実行します。</p>

  <div class="code-container">
   <pre><code class="language-bash">
pip install -r requirements.txt

</code></pre>
  </div>

  <p>pip install は、Pythonのパッケージ管理ツールである pip を使って、指定したパッケージをインストールするためのコマンドです。<br>
   pip は、Pythonパッケージインデックス（PyPI）からパッケージをダウンロードし、インストールするのに使われます。<br>
   では、次にこのテキストファイルとApp Engineの関係についてですね。</p>

  <h3>App Engineとrequirements.txt</h3>
  <p>requirements.txt をApp Engineに置かないと、Flaskは正常に動作しません。<br>
   Flaskアプリケーションが動作するために必要なパッケージや依存関係がインストールされないからです。<br>
   このファイルがないと、App Engineはアプリケーションに必要なパッケージを特定できず、結果として必要なライブラリが不足してしまいます。</p>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="{{ url_for('static', filename='flower1/forest1(1).jpg') }}" alt="フェードアウト効果の草花写真">
   </div>

   <p>FlaskはPythonのウェブフレームワークであり、他にも様々なライブラリと連携して動作します。<br>
    requirements.txt には、そのFlaskアプリケーションが必要とするすべてのライブラリ（およびそのバージョン）がリストアップされています。<br>
    例えば、上記のようにFlask本体やGunicornなどのライブラリが含まれます。<br>
    このファイルをもとに、App Engineはアプリケーションの環境を正確に構築し、依存関係をインストールします。</p>

   <p>App Engineがデプロイ時に requirements.txt を読み込み、指定されたパッケージをインストールすることで、アプリケーションが期待通りに動作する環境が整えられます。<br>
    もしこのファイルがなければ、必要なパッケージがインストールされず、アプリケーションが正しく動作しないのですよ。</p>

  </div>

  <p>したがって、この requirements.txt をプロジェクトに含めることは、Flaskアプリケーションが正常に動作するために非常に重要です。<br>
   これを「そういう仕様だから」と深く考えずに受け入れることもできますが、実際にはプロジェクトの依存関係を管理するために不可欠なファイルだと理解しておくと良いでしょう。</p>


  <h3>App EngineとGunicorn</h3>
  <p>Gunicorn（グニコーン）は、「Green Unicorn」の略で、Pythonで書かれたWSGI（Web Server Gateway
   Interface）HTTPサーバーです。<br>
   主にPythonのウェブフレームワーク（例えばFlaskやDjango）を本番環境で実行するために使用されます。<br>
   Gunicornは、WSGIアプリケーションを効率的に処理するために設計されており、並行リクエストを処理するためのマルチプロセスモデルを採用しています。<br>
   高いパフォーマンスとスケーラビリティが特徴となっていますね。</p>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="{{ url_for('static', filename='flower1/flower1(121).jpg') }}" alt="フェードアウト効果の草花写真">
   </div>

   <p>Google App EngineのPythonランタイムでは、GunicornのようなWSGIサーバーを利用することが推奨されており、公式ドキュメント（<a
     href="https://cloud.google.com/appengine/docs?hl=ja">App Engine
     ドキュメント</a>）にもそのように記載されています。<br>
    つまり、Google App
    Engineを利用する際に、FlaskアプリケーションをデプロイするためにGunicornを使用する設定を行う必要があります。<br>
    ただし、一部の設定は自動的に行われることも、一応は覚えておくと良いかも。</p>

   <p>上述したように、requirements.txt にGunicornを記載する理由は、デプロイ時にApp Engineがプロジェクトの依存関係を正確に把握し、必要なパッケージをインストールするためです。<br>
    requirements.txt にGunicornを記載しておくことで、App Engineが依存関係を適切に解決し、Flaskアプリケーションを実行する準備が整います。<br>
    公式ドキュメントでは、app.yaml ファイルでGunicornを使用してアプリケーションを起動する方法が説明されています。</p>

  </div>

  <div class="code-container">
   <pre><code class="language-yaml">
runtime: python39
entrypoint: gunicorn -b :$PORT main:app

handlers:
- url: /.*
script: auto

</code></pre>
  </div>

  <p>この設定により、App Engineはデプロイ時にGunicornを利用してFlaskアプリケーションを起動します。<br>
   手動でGunicornをインストールしなくても、requirements.txt にGunicornを記載することで、必要な依存関係が自動的にインストールされます。</p>

  <h2>main.pyはFlaskアプリケーションのメインファイル</h2>
  <p>このサイトのFlaskアプリケーションは、静的コンテンツ（HTML、CSS、画像など）と動的コンテンツ（テンプレートを使用した動的なウェブページ）の両方とも、継続しやすいように構成しています。<br>
   上述したように、簡単な構成から始めて、後から段階的に諸機能を実装しやすいようにね。<br>
   ひとまず、このソースコードの動作を簡単に説明しておきます。</p>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="{{ url_for('static', filename='flower1/flower1(122).jpg') }}" alt="フェードアウト効果の草花写真">
   </div>

   <dl>
    <dt>ホームページを表示</dt>
    <dd><span class="codecolor">/</span>にアクセスすると、<span class="codecolor">www</span>ディレクトリの<span
      class="codecolor">index.html</span>が表示されます。</dd>

    <dt>静的ファイルを提供</dt>
    <dd>任意のファイルパス（例えば、<span class="codecolor">/styles.css</span>）にアクセスすると、<span
      class="codecolor">www</span>ディレクトリ内の対応するファイルが表示されます。</dd>

    <dt>動的コンテンツを表示</dt>
    <dd><span class="codecolor">/top</span>にアクセスすると、<span class="codecolor">templates</span>ディレクトリの<span
      class="codecolor">top.html</span>が表示されます。</dd>
   </dl>
   <p>では、実際のソースコードを見ていきましょう。</p>

  </div>

  <p class="codegra" id="flaskmain_py">Flaskのメインファイルとなるmain.py</p>
  <div class="code-container">
   <pre><code class="language-python">
import os
from flask import Flask, render_template, send_from_directory

app = Flask(__name__)

# ルート `/` で `index.html` をレンダリング
@app.route('/')
def serve_static_index():
    return send_from_directory('www', 'index.html')

# 静的ファイルを提供
@app.route('/&lt;path:filename&gt;')
def serve_static_files(filename):
    return send_from_directory('www', filename)

# Flask の動的コンテンツ
@app.route('/top')
def serve_flask_content():
    return render_template('top.html')

if __name__ == '__main__':
    debug_mode = os.getenv('FLASK_DEBUG', 'False') == 'True'
    app.run(debug=debug_mode)

</code></pre>
  </div>

  <p>上述したように、このFlaskアプリにしても、可能な限りリプレイスがやりやすいようにしていきたいものです。<br>
   今後によりますが、このmain.pyは極力単純なままにしておき、サーバーサイドスクリプトを使ったいろんな動作はソースコードを分けていくことで実装をしていく予定です。</p>

  <p><strong>1. インポートとアプリケーションの初期化</strong></p>
  <div class="code-container">
   <pre><code class="language-python">
import os
from flask import Flask, render_template, send_from_directory

app = Flask(__name__)

</code></pre>
  </div>
  <dl>
   <dt><span class="codecolor">import</span></dt>
   <dd>
    Pythonでは、他のモジュールやライブラリを使用するために<span class="codecolor">import</span>キーワードを使います。<br>
    ここでは、<span class="codecolor">os</span>、<span class="codecolor">Flask</span>、<span
     class="codecolor">render_template</span>、<span class="codecolor">send_from_directory</span>をインポートしています。
   </dd>

   <dt><span class="codecolor">Flask(__name__)</span></dt>
   <dd>
    Flaskアプリケーションを初期化します。<br>
    <span class="codecolor">__name__</span>は現在のモジュール名を示します。
   </dd>
  </dl>

  <p><strong>2. ルート / で index.html を提供</strong></p>
  <div class="code-container">
   <pre><code class="language-python">
@app.route('/')
def serve_static_index():
return send_from_directory('www', 'index.html')

</code></pre>
  </div>

  <dl>
   <dt><span class="codecolor">@app.route('/')<span></dt>
   <dd>ルート（エンドポイント）を定義します。<br>
    <span class="codecolor">'/'</span>はウェブサイトのホームページ（トップページ）を意味します。
   </dd>

   <dt><span class="codecolor">send_from_directory<span></dt>
   <dd>指定されたディレクトリからファイルを返します。<br>
    ここでは、<span class="codecolor">www</span>ディレクトリの<span class="codecolor">index.html</span>ファイルを返します。</dd>
  </dl>


  <p><strong>3. 静的ファイルの提供</strong></p>
  <div class="code-container">
   <pre><code class="language-python">
@app.route('/&lt;path:filename&gt;')
def serve_static_files(filename):
return send_from_directory('www', filename)

</code></pre>
  </div>
  <dl>
   <dt><span class="codecolor">@app.route('/&lt;path:filename&gt;')</span></dt>
   <dd>任意のファイルパスを受け取るルートを定義します。<br>
    <span class="codecolor">&lt;path:filename&gt;</span>は動的な部分で、URLに含まれるファイル名がここに入ります。
   </dd>

   <dt><span class="codecolor">send_from_directory('www', filename')</span></dt>
   <dd>指定されたファイル名を持つファイルを<span class="codecolor">www</span>ディレクトリから返します。</dd>
  </dl>


  <p><strong>4. Flask の動的コンテンツの提供</strong></p>
  <div class="code-container">
   <pre><code class="language-python">
@app.route('/top')
def serve_flask_content():
return render_template('top.html')

</code></pre>
  </div>
  <dl>
   <dt><span class="codecolor">@app.route('/top')</span></dt>
   <dd><span class="codecolor">/top</span>というURLパスに対応するルートを定義します。</dd>

   <dt><span class="codecolor">render_template('top.html')</span></dt>
   <dd><span class="codecolor">templates</span>ディレクトリ内の<span
     class="codecolor">top.html</span>テンプレートファイルをレンダリングして返します。<br>
    テンプレートを使用することで、動的なコンテンツを生成できます。</dd>
  </dl>


  <p><strong>5. アプリケーションの実行</strong></p>
  <div class="code-container">
   <pre><code class="language-python">
if __name__ == '__main__':
debug_mode = os.getenv('FLASK_DEBUG', 'False') == 'True'
app.run(debug=debug_mode)

</code></pre>
  </div>
  <dl>
   <dt><span class="codecolor">if __name__ == '__main__':</span></dt>
   <dd>このスクリプトが直接実行されている場合にのみ、以下のコードを実行します。</dd>

   <dt><span class="codecolor">os.getenv('FLASK_DEBUG', 'False') == 'True'</span></dt>
   <dd>環境変数<span class="codecolor">FLASK_DEBUG</span>が<span class="codecolor">True</span>に設定されている場合にデバッグモードを有効にします。</dd>

   <dt><span class="codecolor">app.run(debug=debug_mode)</span></dt>
   <dd>Flaskアプリケーションを実行します。<br>
    <span class="codecolor">debug=debug_mode</span>でデバッグモードを設定します。
   </dd>
  </dl>

  <p>ここまで、依存関係を管理するrequirements.txtと、Flaskアプリケーションのメインファイルmain.pyを見てきました。<br>
   次はApp Engineのyamlについてです。</p>

  <h2>Flaskアプリケーションのapp.yaml</h2>
  <p>このサイトのapp.yamlは、一言で表現すると「Google App Engine 上で動作する Python Flask
   アプリケーションのデプロイと実行環境を設定するための、静的ファイルのルーティングと動的コンテンツの処理を自動化する設定ファイル」となります。</p>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="{{ url_for('static', filename='flower1/flower1(123).jpg') }}" alt="フェードアウト効果の草花写真">
   </div>

   <ul>
    <li>Python 3.12 ランタイムを使用</li>
    <li>自動スケーリングを設定</li>
    <li>環境変数の設定</li>
    <li>静的ファイルと動的コンテンツのルーティング</li>
    <li>キャッシュ制御の設定</li>
    <li>Gunicorn をエントリーポイントとして指定</li>
   </ul>

   <p>このようになっているんですよね。<br>
    実際のコードは次のようになります。</p>

  </div>

  <p class="codegra" id="flaskapp_yaml">Flaskを構築するためのapp.yaml</p>
  <div class="code-container">
   <pre><code class="language-yaml">
runtime: python312
instance_class: F1
env: standard

automatic_scaling:
  min_idle_instances: 0
  max_idle_instances: 1
  max_concurrent_requests: 200

env_variables:
  FLASK_DEBUG: 'False'

handlers:
- url: /static
  static_dir: static

- url: /top
  script: auto

- url: /favicon.ico
  static_files: www/favicon.ico
  upload: www/favicon.ico

- url: /
  static_files: www/index.html
  upload: www/index.html

- url: /(.*)
  static_files: www/\1
  upload: www/(.*)
  http_headers:
    Cache-Control: "public, max-age=3600"

entrypoint: gunicorn -b :$PORT main:app

</code></pre>
  </div>
  <p>注意して頂きたいのは、このソースコードはFlaskアプリの稼働開始時を想定しているという点です。<br>
   分かりやすく言うと、スペックを最低限に抑えている状態なので、トラフィックが上がってきたら変更するようにしてください。<br>
   各セクションの説明をしていきます。</p>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="{{ url_for('static', filename='flower1/forest1(134).jpg') }}" alt="フェードアウト効果の草花写真">
   </div>

   <p><strong>runtime: python312</strong></p>
   <p><span class="codecolor">Python 3.12</span> を使用することを指定しています。<br>
    このアプリケーションはPythonのバージョン3.12で動作します。</p>

   <p><strong>instance_class: F1</strong></p>
   <p>アプリケーションが動作するインスタンスのクラスを指定しています。<br>
    <span class="codecolor">F1</span>は標準的なクラスで、主に小規模アプリに使用されます。
   </p>

   <p><strong>env: standard</strong></p>
   <p>実行環境を「標準（Standard）」として指定しています。<br>
    これは標準環境でアプリケーションを実行することを意味します。</p>

   <p><strong>automatic_scaling</strong></p>
   <p>自動スケーリングの設定を定義しています。<br>
    つまり、アプリケーションの負荷に応じて自動的にインスタンスの数を調整します。</p>
   <dl>
    <dt>min_idle_instances: 0</dt>
    <dd>アイドル状態（待機状態）で最低0個のインスタンスを保持します。</dd>

    <dt>max_idle_instances: 1</dt>
    <dd>アイドル状態で最大1個のインスタンスを保持します。</dd>

    <dt>max_concurrent_requests: 200</dt>
    <dd>1つのインスタンスが同時に処理できる最大リクエスト数は200です。</dd>
   </dl>

  </div>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="{{ url_for('static', filename='flower1/forest1(135).jpg') }}" alt="フェードアウト効果の草花写真">
   </div>

   <p>注意して欲しいのはここなんですよ。<br>
    上記の設定では、例えば私のアプリケーション規模だと厳しいのです。<br>
    アプリケーションが負荷に耐えられず、リクエストの処理に遅延が生じたり、エラーが発生する可能性があります。<br>
    とりあえず max_idle_instances は増やしていますが、Cloud Load Balancing を使うか考えているところです。</p>

   <p><strong>env_variables</strong></p>
   <p>環境変数の設定を行います。</p>
   <dl>
    <dt>FLASK_DEBUG: 'False'</dt>
    <dd>Flaskのデバッグモードを無効（False）に設定します。<br>
     これは本番環境でデバッグ情報を表示しないようにするためです。</dd>
   </dl>

  </div>

  <p><strong>handlers</strong></p>
  <p>URLごとに異なる動作を定義するハンドラー設定です。</p>
  <dl>
   <dt>url: /static</dt>
   <dd><span class="codecolor">/static</span> というURLにアクセスしたとき、<span class="codecolor">static</span>
    ディレクトリ内の静的ファイルを提供します。</dd>

   <dt>url: /top</dt>
   <dd><span class="codecolor">/top</span> というURLにアクセスしたとき、自動的にスクリプトを実行します（<span class="codecolor">auto</span>
    はFlaskの設定に基づいています）。</dd>

   <dt>url: /favicon.ico</dt>
   <dd><span class="codecolor">/favicon.ico</span> というURLにアクセスしたとき、<span class="codecolor">www/favicon.ico</span>
    ファイルを提供します。</dd>

   <dt>url: /</dt>
   <dd>ルートURL（<span class="codecolor">/</span>）にアクセスしたとき、<span class="codecolor">www/index.html</span> ファイルを提供します。</dd>

   <dt>url: /(.*)</dt>
   <dd>その他のすべてのURLに対して、<span class="codecolor">www</span> ディレクトリ内の対応するファイルを提供します。</dd>

   <dt>http_headers</dt>
   <dd>キャッシュ制御の設定を行います。<br>
    ここでは、<span class="codecolor">Cache-Control</span> ヘッダーを設定し、公開キャッシュを最大1時間（<span class="codecolor">3600</span>秒）保持します。
   </dd>
  </dl>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="{{ url_for('static', filename='flower1/forest1(136).jpg') }}" alt="フェードアウト効果の草花写真">
   </div>

   <p><strong>entrypoint</strong></p>
   <p>アプリケーションのエントリーポイントを指定しています。</p>
   <dl>
    <dt>gunicorn -b :$PORT main:app</dt>
    <dd>GunicornというHTTPサーバーを使用してFlaskアプリケーションを実行します。<br>
     <span class="codecolor">$PORT</span>はApp Engineが提供するポート番号で、<span class="codecolor">main:app</span>は<span
      class="codecolor">main.py</span>ファイル内のFlaskアプリケーションを指します。
    </dd>
   </dl>

   <p>この設定ファイルにより、アプリケーションがどのように動作し、どのようにリクエストに応答するかを指定しています。<br>
    簡単に言えば、このファイルがアプリケーションの「動作マニュアル」みたいなものです。</p>

  </div>

  <p>上述したapp.yamlで普通とは違う部分があるとすれば、次のハンドラー設定でしょうか。</p>

  <div class="code-container">
   <pre><code class="language-yaml">
  - url: /
  static_files: www/index.html
  upload: www/index.html

  - url: /(.*)
  static_files: www/\1
  upload: www/(.*)
  http_headers:
  Cache-Control: "public, max-age=3600"

</code></pre>
  </div>

  <p>この設定により、<span class="codecolor">www</span>ディレクトリ内のファイルが直接提供されるようになっています。</p>

  <h3>Flaskのurl_for関数</h3>
  <p>Flaskの url_for は、Flaskが提供する関数で、ビュー関数（ルート）や静的ファイルに対応するURLを動的に生成するために使用されます。<br>
   これでアプリケーションのルーティングが変更された場合でも、テンプレート内のリンクを自動で更新でき、一貫性とメンテナンス性が向上します。</p>

  <p class="gra">url_forの基本的な使い方</p>
  <h5>1. ビュー関数へのURL生成</h5>
  <p>例えば、次のようなFlaskアプリケーションがあるとしましょう。</p>

  <div class="code-container">
   <pre><code class="language-python">
# main.py
from flask import Flask

app = Flask(__name__)

@app.route('/hello')
def hello():
return 'こんにちは、世界！'

</code></pre>
  </div>

  <p>テンプレート内で、このhello関数へのリンクを作成するには、次のようにします。</p>

  <div class="code-container">
   <pre><code class="language-html">
{% raw %}&lt;!-- テンプレートファイル（例：templates/index.html） --&gt;
  &lt;a href=&quot;{{ url_for(&#39;hello&#39;) }}&quot;&gt;挨拶ページへ&lt;/a&gt;
{% endraw %}
</code></pre>
  </div>

  <p>url_for('hello') は、自動的に /hello というURLを生成します。</p>

  <h5>2. 静的ファイルへのURL生成</h5>
  <p>Flaskはデフォルトで static ディレクトリ内のファイルを静的ファイルとして提供します。<br>
   静的ファイルへのリンクを作成するには、次のようにします。</p>

  <div class="code-container">
   <pre><code class="language-html">
{% raw %}&lt;img src=&quot;{{ url_for(&#39;static&#39;, filename=&#39;images/logo.png&#39;) }}&quot; alt=&quot;ロゴ&quot;&gt;
{% endraw %}
</code></pre>
  </div>
  <p>この例では、static/images/logo.png にある画像ファイルへのURLを生成します。</p>

  <p class="gra">url_forを使うメリット</p>

  <dl>
   <dt>ルーティングの一元管理</dt>
   <dd>ルートのパスを変更しても、テンプレート内のリンクを修正する必要がありません。</dd>

   <dt>エラー防止</dt>
   <dd>ハードコードされたURLを避けることで、タイプミスやパスの変更によるエラーを防ぎます。</dd>

   <dt>動的なURL生成</dt>
   <dd>引数を渡すことで、パラメータ付きのURLを生成できます。</dd>
  </dl>

  <div class="code-container">
   <pre><code class="language-python">
@app.route('/user/&lt;username&gt;')
def profile(username):
return f'{username}さんのプロフィール'

</code></pre>
  </div>
  <div class="spacer"></div>
  <div class="code-container">
   <pre><code class="language-html">
{% raw %}&lt;a href=&quot;{{ url_for(&#39;profile&#39;, username=&#39;fein&#39;) }}&quot;&gt;feinさんのプロフィールを見る&lt;/a&gt;
{% endraw %}
</code></pre>
  </div>

  <h4>このfein's app独特の設定</h4>
  <p>上述した内容と少し重複しますが、app.yamlまで説明を終えたことにより、追記できることがあります。<br>
   このfein's appのプロジェクト構造では、<span class="codecolor">www</span>ディレクトリ内のファイルはFlaskではなく、<span
    class="codecolor">app.yaml</span>の設定によって直接サーバーから提供されています。<br>
   このため、<span class="codecolor">url_for</span>を使用しても、<span class="codecolor">www</span>ディレクトリ内のファイルへのURLを正しく生成できないのです。
  </p>

  <ul>
   <li><span class="codecolor">url_for</span>はFlaskアプリケーションが管理するルートや静的ファイルのみを認識します。</li>
   <li><span class="codecolor">www</span>ディレクトリ内のファイルはFlaskを経由せずに提供されているため、<span
     class="codecolor">url_for</span>はこれらのファイルを知らない状態です。</li>
  </ul>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="{{ url_for('static', filename='flower1/forest1(137).jpg') }}" alt="フェードアウト効果の草花写真">
   </div>

   <p>しかし、これはデメリットではありません。<br>
    <span class="codecolor">www</span>ディレクトリ内にあるHTMLコードをそのまま持って来れるのですよ。<br>
    本格的にFlaskを活かしたアプリケーションを構築しつつも、静的ウェブサイトにある資源を活かせるのです。<br>
    真新しくFlaskアプリを作り込んでいくのは大変でしょ？<br>
    いつでも動的コンテンツを実装できるよう環境を整えつつ、静的ウェブサイトから使えるものを流用できるようにしたわけです。
   </p>
   <p>よって、<span class="codecolor">www</span>ディレクトリ内のファイルへのリンクは、これまで通りハードコードされたパスが使用されています。─ 少なくともこのページにおいては ─<br>
    次のような、普通の a href タグの書き方ができるということですね。</p>

  </div>

  <div class="code-container">
   <pre><code class="language-html">
&lt;a href=&quot;/index.html&quot;&gt;ホーム&lt;/a&gt;

</code></pre>
  </div>

  <h2>VS Codeのtasks.json</h2>
  <p>tasks.json は、Visual Studio Code（VS Code）で使用するタスクを定義する設定ファイルです。<br>
   このファイルを使うと、開発中によく行う作業（コマンドの実行やビルドなど）を簡単に自動化できます。<br>
   複雑なコマンドを毎回手動で入力する必要がなくなるんだよね。</p>

  <p>次にあるソースコードは、Google Cloud SDK ShellやFlaskのローカル起動をワンタッチでできるようにしたものです。</p>

  <p class="codegra" id="flasktasks_json">作業を省力化するtasks.json</p>
  <div class="code-container">
   <pre><code class="language-json">
{
 "version": "2.0.0",
 "tasks": [
  {
   "label": "Google Cloud SDK Shell を起動",
   "type": "shell",
   "command": "cmd",
   "args": [
    "/c",
    "\"\"C:\\Users\\ユーザー名\\AppData\\Local\\Google\\Cloud SDK\\cloud_env.bat\" && cd \"C:\\Users\\ユーザー名\\OneDrive\\_fein\\google cloud\\fein-sites-dev1\" && cmd\""
   ],
   "problemMatcher": [],
   "group": {
    "kind": "build",
    "isDefault": true
   }
  },
  {
   "label": "Flaskアプリを起動",
   "type": "shell",
   "command": "cmd",
   "args": [
    "/C",
    "\"cd C:\\Users\\ユーザー名\\OneDrive\\_fein\\google cloud\\fein-sites-dev1 && set FLASK_APP=main.py && set FLASK_ENV=development && set FLASK_DEBUG=1 && flask run\""
   ],
   "isBackground": true,
   "problemMatcher": [
    {
     "pattern": [
      {
       "regexp": ".",
       "file": 1,
       "location": 2,
       "message": 3
      }
     ],
     "background": {
      "activeOnStart": true,
      "beginsPattern": ".",
      "endsPattern": "."
     }
    }
   ],
   "presentation": {
    "echo": true,
    "reveal": "always",
    "focus": true,
    "panel": "dedicated"
   }
  },
  {
   "label": "ブラウザを開く",
   "type": "shell",
   "command": "cmd",
   "args": [
    "/C",
    "timeout /T 5 & start msedge \"http://127.0.0.1:5000/\""
   ],
   "presentation": {
    "echo": false,
    "reveal": "never",
    "focus": false,
    "panel": "shared"
   }
  },
  {
   "label": "Flaskアプリ起動とブラウザを開く",
   "dependsOn": [
    "Flaskアプリを起動",
    "ブラウザを開く"
   ],
   "problemMatcher": [],
   "presentation": {
    "echo": false,
    "reveal": "never",
    "focus": false,
    "panel": "shared"
   }
  }
 ]
}

</code></pre>
  </div>

  <p>この tasks.json には4つのタスクが定義されています。</p>

  <ol>
   <li>Google Cloud SDK Shell を起動</li>
   <li>Flaskアプリを起動</li>
   <li>ブラウザを開く</li>
   <li>Flaskアプリ起動とブラウザを開く</li>
  </ol>

  <p>では、各タスクが何をしているのか、一つずつ詳しく見ていきましょう。</p>

  <h5>Google Cloud SDK Shell を起動</h5>

  <dl>
   <dt>ラベル（label）</dt>
   <dd><span class="codecolor">Google Cloud SDK Shell を起動</span></dd>

   <dt>タイプ（type）</dt>
   <dd><span class="codecolor">"shell"</span>（シェルコマンドを実行するタイプ）</dd>

   <dt>コマンド（command）</dt>
   <dd><span class="codecolor">"cmd"</span>（Windowsのコマンドプロンプトを起動）</dd>

   <dt>引数（args）</dt>
   <dd>コマンドに渡すパラメータ（詳細は後述）</dd>
  </dl>

  <p>このタスクは、Google Cloudのコマンドラインツールを使える状態にし、指定したプロジェクトのフォルダに移動します。<br>
   argsの内容は次の通りです。</p>

  <div class="code-container">
   <pre><code class="language-json">
[
"/c",
"\"\"C:\\Users\\ユーザー名\\AppData\\Local\\Google\\Cloud SDK\\cloud_env.bat\" && cd
\"C:\\Users\\ユーザー名\\OneDrive\\_fein\\google cloud\\fein-sites-dev1\" && cmd\""
]

</code></pre>
  </div>

  <p><span class="codecolor">/c</span> は、コマンドプロンプトに指定したコマンドを実行させ、その後に終了させるオプションです。<br>
   実行されるコマンドの流れは次のようになります。</p>

  <dl>
   <dt>1. Google Cloud SDKの環境を設定</dt>
   <dd><span class="codecolor">"C:\\Users\\ユーザー名\\AppData\\Local\\Google\\Cloud
     SDK\\cloud_env.bat"</span>を実行します。これにより、Google Cloud SDKが使えるようになります。</dd>

   <dt>2. プロジェクトのフォルダに移動</dt>
   <dd><span class="codecolor">cd "C:\\Users\\ユーザー名\\OneDrive\\_fein\\google
     cloud\\fein-sites-dev1"</span>で、あなたのプロジェクトのフォルダに移動します。</dd>

   <dt>3. 新しいコマンドプロンプトを開く</dt>
   <dd><span class="codecolor">cmd</span>を実行して、新しくコマンドプロンプトを開きます。</dd>
  </dl>

  <p>このタスクを実行すると、Google Cloud SDKの設定が済んだ状態で、VS Codeのプロジェクトフォルダに移動したコマンドプロンプトが開きます。<br>
   すぐにGoogle Cloud関連のコマンドを使える状態になりますよ。</p>


  <h5>Flaskアプリを起動</h5>

  <dl>
   <dt>ラベル（label）</dt>
   <dd><span class="codecolor">Flaskアプリを起動</span></dd>

   <dt>タイプ（type）</dt>
   <dd><span class="codecolor">"shell"</span></dd>

   <dt>コマンド（command）</dt>
   <dd><span class="codecolor">"cmd"</span></dd>

   <dt>引数（args）</dt>
   <dd>コマンドに渡すパラメータ（詳細は後述）</dd>

   <dt>バックグラウンド実行（isBackground）</dt>
   <dd><span class="codecolor">true</span>（バックグラウンドで実行する設定）</dd>
  </dl>

  <p>このタスクはFlaskを起動します。<br>
   argsの内容は次の通りです。</p>

  <div class="code-container">
   <pre><code class="language-json">
[
"/C",
"\"cd C:\\Users\\ユーザー名\\OneDrive\\_fein\\google cloud\\fein-sites-dev1 && set FLASK_APP=main.py && set
FLASK_ENV=development && set FLASK_DEBUG=1 && flask run\""
]

</code></pre>
  </div>

  <p><span class="codecolor">/C</span> は、コマンドプロンプトに指定したコマンドを実行させ、その後に終了させるオプションです。<br>
   実行されるコマンドの流れは次のようになります。</p>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="{{ url_for('static', filename='flower1/forest1(10).jpg') }}" alt="フェードアウト効果の草花写真">
   </div>
   <dl>
    <dt>1. プロジェクトのフォルダに移動</dt>
    <dd><span class="codecolor">cd C:\\Users\\ユーザー名\\OneDrive\\_fein\\google cloud\\fein-sites-dev1</span></dd>

    <dt>2. 環境変数の設定</dt>
    <dd><span class="codecolor">set FLASK_APP=main.py</span><br>Flaskにどのファイルを実行するか指定します。<span
      class="codecolor">main.py</span>がアプリの本体です。</dd>
    <dd><span class="codecolor">set FLASK_ENV=development</span><br>開発モードに設定します。デバッグ情報が見られます。</dd>
    <dd><span class="codecolor">set FLASK_DEBUG=1</span><br>デバッグモードを有効にします。エラーが出たときに詳しい情報が表示されます。</dd>

    <dt>3. Flaskアプリを起動</dt>
    <dd><span class="codecolor">flask run</span>でアプリを実行し、ウェブサーバーを立ち上げます。</dd>
    <dd><strong>バックグラウンド実行</strong><br><span class="codecolor">isBackground:
      true</span>により、タスクはバックグラウンドで動作します。これで他の作業がしやすくなります。</dd>
   </dl>

  </div>

  <p>デバッグモードは開発中は便利ですが、本番環境（みんなが使う環境）ではオフにするのが一般的です。<br>
   このタスクを実行すると、Flaskアプリケーションが起動し、ウェブブラウザからアクセスできるようになります。</p>

  <h5>ブラウザを開く</h5>

  <dl>
   <dt>ラベル（label）</dt>
   <dd><span class="codecolor">ブラウザを開く</span></dd>

   <dt>タイプ（type）</dt>
   <dd><span class="codecolor">"shell"</span></dd>

   <dt>コマンド（command）</dt>
   <dd><span class="codecolor">"cmd"</span></dd>

   <dt>引数（args）</dt>
   <dd>コマンドに渡すパラメータ（詳細は後述）</dd>
  </dl>

  <p>このタスクは、ブラウザを自動的に開き、起動したFlaskアプリにアクセスします。<br>
   argsの内容は次の通りです。</p>

  <div class="code-container">
   <pre><code class="language-json">
[
"/C",
"timeout /T 5 & start msedge \"http://127.0.0.1:5000/\""
]

</code></pre>
  </div>

  <p><span class="codecolor">/C</span> は、コマンドプロンプトに指定したコマンドを実行させ、その後に終了させるオプションです。<br>
   実行されるコマンドの流れは次のようになります。</p>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="{{ url_for('static', filename='flower1/forest1(20).jpg') }}" alt="フェードアウト効果の草花写真">
   </div>

   <dl>
    <dt><span class="codecolor">timeout /T 5</span></dt>
    <dd>5秒間待機します。これは、Flaskアプリが起動するのを待つためです。</dd>

    <dt><span class="codecolor">&</span></dt>
    <dd>コマンドを続けて実行するための記号です。</dd>

    <dt><span class="codecolor">start msedge "http://127.0.0.1:5000/"</span></dt>
    <dd>Microsoft Edgeを開き、<span class="codecolor">http://127.0.0.1:5000/</span>にアクセスします。</dd>

    <dt><span class="codecolor">msedge</span></dt>
    <dd>Microsoft Edgeのことです。他のブラウザを使いたい場合は、<span class="codecolor">chrome</span>や<span
      class="codecolor">firefox</span>に変更できます。</dd>

    <dt><span class="codecolor">http://127.0.0.1:5000/</span></dt>
    <dd>ローカルホスト（自分のコンピュータ）で動いているFlaskアプリのアドレスです。</dd>
   </dl>

  </div>

  <p>アプリの起動が遅い場合、待機時間（<span class="codecolor">/T 5</span>の<span class="codecolor">5</span>）を増やすと良いです。<br>
   このタスクを実行すると、自動的にブラウザが開き、作成中のFlaskアプリにアクセスします。</p>

  <h5>Flaskアプリ起動とブラウザを開く</h5>

  <dl>
   <dt>ラベル（label）</dt>
   <dd><span class="codecolor">Flaskアプリ起動とブラウザを開く</span></dd>

   <dt>依存タスク（dependsOn）</dt>
   <dd><span class="codecolor">["Flaskアプリを起動", "ブラウザを開く"]</span></dd>
  </dl>

  <p>このタスクは、先ほどの「Flaskアプリを起動」と「ブラウザを開く」の2つのタスクを順番に実行します。<br>
   <span class="codecolor">dependsOn</span> のタスクは他のタスクに依存しています。<br>
   つまり、指定したタスクを自動的に実行します。<br>
   Flaskアプリを起動し、ブラウザを開きます。<br>
   プレゼンテーション設定（presentation）は、次のようになります。
  </p>

  <div class="code-container">
   <pre><code class="language-json">
{
"echo": false,
"reveal": "never",
"focus": false,
"panel": "shared"
}

</code></pre>
  </div>
  <dl>
   <dt><span class="codecolor">echo</span>: false</dt>
   <dd>実行するコマンドを表示しません。</dd>

   <dt><span class="codecolor">reveal</span>: "never"</dt>
   <dd>ターミナルを自動的に表示しません。</dd>

   <dt><span class="codecolor">focus</span>: false</dt>
   <dd>ターミナルにフォーカスしません。</dd>

   <dt><span class="codecolor">panel</span>: "shared"</dt>
   <dd>ターミナルパネルを共有します。他のタスクと同じパネルを使います。</dd>
  </dl>

  <p>私はこうやって tasks.json を書いているけど、やりやすい型は人によって違うでしょうね。<br>
   あとは Ctrl + Shift + P で「タスクの実行」を選択し、表示されたタスクを選ぶだけ。<br>
   「Flaskアプリ起動とブラウザを開く」を選べば、一度にアプリの起動とブラウザのオープンができます。</p>

  <p>もしくは、次のように run_flask.bat みたいな名前のbatファイルを作ってもいいでしょう。</p>

  <div class="code-container">
   <pre><code class="language-bash">
@echo off
cd "C:\Users\ユーザー名\OneDrive\_fein\google cloud\fein-sites-dev1"
set FLASK_APP=main.py
set FLASK_ENV=development
set FLASK_DEBUG=1
flask run

</code></pre>
  </div>
  <p>このバッチファイルをダブルクリックして実行してもワンタッチでやれます。<br>
   私はVS Code内部にいたいから、ターミナルパネルを使っていますね。</p>

  <p class="feintag">このページをFlaskフレームワークのトップページにします</p>

  <!-- ●ここから人間用のフッター● -->
  <hr id="feinhr">
  <div class="spacer"></div>

  <section class="sitemap">
   <h2 class="sitemap_heading">サイトマップ</h2>
   <p><a href="/another-eden/anaden_sitemap.html"><i class="fas fa-sitemap"></i>
     アナザーエデン関連ページ・サイトマップ</a></p>
   <p>アナザーエデンの強敵戦やストーリーコンテンツのリスト、お勧めバッジなどを掲載したコーナーです。<br>
    期間限定のない普通のRPGですので、初心者でも安心して続けていけるゲームとなっています。<br>
    もっとも重要なグラスタについては、場所別に網羅した表があります。</p>


   <div class="spacer"></div>
   <p><a href="/contents/site_create.html"><i class="fas fa-sitemap"></i>
     個人サイトのホスティングとコンテンツ作成</a></p>
   <p>個人でウェブサイトを作るにはどうすればいいか。<br>
    HTML・CSS・JavaScriptの書き方はもちろん、無料かつ広告なしでホームページを作る方法を掲載したコーナーです。<br>
    Webデザインやレイアウトについても書いてあります。</p>
   <div class="spacer"></div>
   <p><a href="/fish/fish_sitemap.html"><i class="fas fa-sitemap"></i>魚釣りなどアウトドアのエリア</a></p>
   <p>ゲームとパソコンだけじゃなく、アウトドアも趣味なんです。<br>
    このコーナーでは魚釣りの記録とか、魚料理のレシピ、はたまたサイクリングなどなど。<br>
    アウトドアに関連するコンテンツが詰め込まれています。</p>

  </section>

  <!-- ページ上部へ戻るボタン -->
  <button id="scrollToTopBtn" onclick="scrollToTop()">ページ上部へ戻る</button>
  <script src="{{ url_for('static', filename='js/feinScroll.js') }}"></script>

  <div class="spacer"></div>

  <footer>
   <!--common google digital leader-->

   <div id="commongdl"></div>
   <script src="{{ url_for('static', filename='externalization/common.js') }}"></script>

   <div class="spacer"></div>

   <!--w3cバリデーターに合格していることを示す-->
   <div class="w3ccheck">
    <a href="https://validator.w3.org/nu/?doc={{ url_for('static', filename='contents/site_create.html') }}">
     <img src="{{ url_for('static', filename='images/HTML5_Logo_64.png') }}" alt="Valid HTML5" height="31"
      style="width: auto;">
    </a>
    <a href="https://validator.w3.org/nu/?doc={{ url_for('static', filename='css/style.css') }}">
     <img style="border:0;width:88px;height:31px" src="{{ url_for('static', filename='images/vcss-blue.png') }}"
      alt="正当なCSSです!">
    </a>
   </div>

   <!--w3cバリデーターに合格していることを示す-->

   <div class="spacer"></div>
   <p class="portal" id="updated-date">この <a href="https://fein-sites-dev1.ew.r.appspot.com/">fein's personal
     site</a> は、2023/7/4に開設された <a href="https://sites.google.com/view/feins-portal/">fein's portal</a>
    を母体として、yyyy/mm/ddに至るまで更新し続けられています。</p>
   <script>
    document.addEventListener('DOMContentLoaded', function () {
     const today = new Date();
     const year = today.getFullYear();
     const month = String(today.getMonth() + 1).padStart(2, '0');
     const day = String(today.getDate()).padStart(2, '0');
     const dateElement = document.getElementById('updated-date');
     dateElement.innerHTML = `この <a href="https://fein-sites-dev1.ew.r.appspot.com/">fein's personal site</a> は、2023/7/4に開設された <a href="https://sites.google.com/view/feins-portal/">fein's portal</a> を母体として、${year}/${month}/${day}に至るまで更新し続けられています。`;
    });
   </script>

  </footer>

 </div><!--レスポンシブデザイン-->

 <script src="{{ url_for('static', filename='js/feinheadline1.js') }}"></script><!--見出しの自動生成-->

 <!-- ●ここまで人間用のフッター。直下でbodyを閉める● -->
</body>

</html>
